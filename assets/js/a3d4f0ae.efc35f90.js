"use strict";(self.webpackChunkanswer=self.webpackChunkanswer||[]).push([[187],{9613:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(9496);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=o,g=p["".concat(s,".").concat(m)]||p[m]||c[m]||i;return n?a.createElement(g,r(r({ref:t},d),{},{components:n})):a.createElement(g,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},1856:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var a=n(4250),o=(n(9496),n(9613));const i={},r="Backend",l={unversionedId:"development/contributing/backend",id:"development/contributing/backend",title:"Backend",description:"Below is the guideline for Backend Development",source:"@site/docs/development/contributing/backend.md",sourceDirName:"development/contributing",slug:"/development/contributing/backend",permalink:"/docs/development/contributing/backend",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Contributing",permalink:"/docs/development/contributing/"},next:{title:"Frontend",permalink:"/docs/development/contributing/frontend"}},s={},u=[{value:"How to set up a development environment",id:"how-to-set-up-a-development-environment",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Tools",id:"tools",level:3},{value:"wire",id:"wire",level:4},{value:"swag",id:"swag",level:4},{value:"Build",id:"build",level:3},{value:"Run",id:"run",level:3},{value:"Install",id:"install",level:4},{value:"Launch",id:"launch",level:4},{value:"Debug",id:"debug",level:3},{value:"Project instructions",id:"project-instructions",level:2},{value:"Package",id:"package",level:3},{value:"Dependencies between packages",id:"dependencies-between-packages",level:3},{value:"Code specification",id:"code-specification",level:2},{value:"Basic",id:"basic",level:3},{value:"Lint",id:"lint",level:3},{value:"What do we need you to contribute",id:"what-do-we-need-you-to-contribute",level:2},{value:"Fix Bug",id:"fix-bug",level:3},{value:"Code Review &amp; Comment",id:"code-review--comment",level:3},{value:"Unit Tests(Much-needed)",id:"unit-testsmuch-needed",level:3},{value:"Translation",id:"translation",level:3},{value:"Features or Plugin",id:"features-or-plugin",level:3},{value:"Notice",id:"notice",level:2},{value:"Modify the database table structure is very hard",id:"modify-the-database-table-structure-is-very-hard",level:3},{value:"Built with",id:"built-with",level:2}],d={toc:u};function c(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"backend"},"Backend"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Below is the guideline for Backend Development")),(0,o.kt)("h2",{id:"how-to-set-up-a-development-environment"},"How to set up a development environment"),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://go.dev/"},"Golang")," ",(0,o.kt)("inlineCode",{parentName:"li"},">=1.18")),(0,o.kt)("li",{parentName:"ul"},"Database Dependencies",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"MySQL ",(0,o.kt)("inlineCode",{parentName:"li"},"(>=5.7)")),(0,o.kt)("li",{parentName:"ul"},"PostgreSQL ",(0,o.kt)("inlineCode",{parentName:"li"},"(>=10)")),(0,o.kt)("li",{parentName:"ul"},"SQLite3"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/google/wire"},"wire"))),(0,o.kt)("h3",{id:"tools"},"Tools"),(0,o.kt)("h4",{id:"wire"},"wire"),(0,o.kt)("p",null,"We use ",(0,o.kt)("inlineCode",{parentName:"p"},"wire")," to generate dependencies."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ go get github.com/google/wire/cmd/wire@latest\n$ go generate ./...\n$ go mod tidy\n")),(0,o.kt)("p",null,"Or you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"make generate"),"."),(0,o.kt)("h4",{id:"swag"},"swag"),(0,o.kt)("p",null,"We use ",(0,o.kt)("inlineCode",{parentName:"p"},"swag")," to generate swagger doc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ swag init --generalInfo ./cmd/answer/main.go\n")),(0,o.kt)("p",null,"Or you can use enter the script directory and use ",(0,o.kt)("inlineCode",{parentName:"p"},"./gen-api.sh")),(0,o.kt)("h3",{id:"build"},"Build"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If this is your first time starting the Answer, it is best to compile the frontend project once to ensure that you can test it more easily.\nOnce you get comfortable with the answer, you can copy the configuration file directly to the corresponding directory without compiling the front-end and test it with swagger.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# Frontend compilation(Recommend). If you encounter problems, please refer to the frontend related documentation\n$ make ui\n# enter into dir\n$ cd cmd/answer/\n# compile\n$ go build .\n")),(0,o.kt)("h3",{id:"run"},"Run"),(0,o.kt)("h4",{id:"install"},"Install"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If this is your first time starting the Answer, you need to follow the steps to install. If not, you can skip this step.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# init environment\n$ ./answer init -C ./answer-data/\n")),(0,o.kt)("p",null,"Heading to ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:80/install"},"http://localhost:80/install")," to access installation page."),(0,o.kt)("p",null,"Please refer to the ",(0,o.kt)("a",{parentName:"p",href:"../../installation"},"installation documentation")," for installation steps."),(0,o.kt)("h4",{id:"launch"},"Launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ ./answer run -C ./answer-data/\n")),(0,o.kt)("p",null,"Heading to ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:80/"},"http://localhost:80/")," to use answer."),(0,o.kt)("h3",{id:"debug"},"Debug"),(0,o.kt)("p",null,"We use swagger to test api interface. Swagger documentation default is available.\nHeading to ",(0,o.kt)("a",{parentName:"p",href:"http://127.0.0.1:8080/swagger/index.html"},"http://localhost:80/swagger/index.html")," to access swagger page."),(0,o.kt)("p",null,"You can use swagger for more convenient debugging."),(0,o.kt)("h2",{id:"project-instructions"},"Project instructions"),(0,o.kt)("h3",{id:"package"},"Package"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 cmd (main binary)\n\u251c\u2500\u2500 configs (default configuration)\n\u251c\u2500\u2500 docs (swagger documentation)\n\u251c\u2500\u2500 i18n (International translation)\n\u251c\u2500\u2500 internal\n      \u251c\u2500\u2500 base (Basic component without service attributes)\n            \u251c\u2500\u2500 conf (Configuration)\n            \u251c\u2500\u2500 constant (constant)\n            \u251c\u2500\u2500 data (database/cache)\n            \u251c\u2500\u2500 handler (request/response handler)\n            \u251c\u2500\u2500 middleware (http middleware)\n            \u251c\u2500\u2500 pager (Pagination)\n            \u251c\u2500\u2500 reason (error reason key use to translator)\n            \u251c\u2500\u2500 server (http server)\n            \u251c\u2500\u2500 translator (translator for translate international)\n            \u2514\u2500\u2500 validator (validator for validate request)\n      \u251c\u2500\u2500 cli (binary commands)\n      \u251c\u2500\u2500 controller (request handler controller for user)\n      \u251c\u2500\u2500 controller_backyard (request handler controller for admin)\n      \u251c\u2500\u2500 entity (all entity about database table)\n      \u251c\u2500\u2500 install (installation related)\n      \u251c\u2500\u2500 migrations (upgrade related)\n      \u251c\u2500\u2500 repo (database/cache operations)\n      \u251c\u2500\u2500 router (http router)\n      \u251c\u2500\u2500 schema (request/response schema)\n      \u2514\u2500\u2500 service (business logic)\n\u251c\u2500\u2500 pkg (tools or third party)\n\u2514\u2500\u2500 ui (frontend)\n")),(0,o.kt)("h3",{id:"dependencies-between-packages"},"Dependencies between packages"),(0,o.kt)("p",null,"For most api, the flow chart is very simple as follows."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"router -> middleware -> controller(use schema) -> service -> repo(use entity)\n")),(0,o.kt)("p",null,"If you want to develop a new API, you can follow the steps below."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Adding a routing rule (GET/POST/PUT...) in router."),(0,o.kt)("li",{parentName:"ol"},"Adding a controller for handler requests. the request should be validated in the controller."),(0,o.kt)("li",{parentName:"ol"},"Adding a service to process business."),(0,o.kt)("li",{parentName:"ol"},"Adding a repo for saving or querying data from the database or cache."),(0,o.kt)("li",{parentName:"ol"},"Regenerate swagger documentation and test API.")),(0,o.kt)("h2",{id:"code-specification"},"Code specification"),(0,o.kt)("h3",{id:"basic"},"Basic"),(0,o.kt)("p",null,"We recommend that you follow ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/uber-go/guide"},"uber's Golang Guidelines")," code style."),(0,o.kt)("h3",{id:"lint"},"Lint"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"golangci-lint")," is a fast Go linters runner. We use ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/golangci/golangci-lint"},"golangci-lint")," to lint our code."),(0,o.kt)("p",null,"You can use the following command to check your code format."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.50.0\n$ golangci-lint run\n")),(0,o.kt)("h2",{id:"what-do-we-need-you-to-contribute"},"What do we need you to contribute"),(0,o.kt)("h3",{id:"fix-bug"},"Fix Bug"),(0,o.kt)("p",null,"If you find a bug, please don't hesitate to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/apache/incubator-answer/issues"},"submit an issue")," to us.\nIf you can fix it, please include a note with your issue submission.\nIf it is a bug definitely, you can submit your PR after we confirm it, which will ensure you don't do anything useless."),(0,o.kt)("h3",{id:"code-review--comment"},"Code Review & Comment"),(0,o.kt)("p",null,"In our development, some codes are not logical we know. If you find it, please don't hesitate to submit PR to us.\nIn the same way, some function has no comment. We would appreciate it if you could help us supplement it."),(0,o.kt)("h3",{id:"unit-testsmuch-needed"},"Unit Tests(Much-needed)"),(0,o.kt)("p",null,"Our current unit test coverage is as follows. As you can see we have many more unit tests to add, so we would be happy for you to add them."),(0,o.kt)("img",{src:n(3615).Z,alt:"repo-unit-test-coverage-rate",width:"300"}),(0,o.kt)("h3",{id:"translation"},"Translation"),(0,o.kt)("p",null,"All our translations are placed in the i18n directory."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"If you find that the corresponding key in the language you are using does not have a translation, you can submit your translation."),(0,o.kt)("li",{parentName:"ol"},"If you want to submit a new language translation, please add your language to the ",(0,o.kt)("inlineCode",{parentName:"li"},"i18n.yaml")," file.")),(0,o.kt)("h3",{id:"features-or-plugin"},"Features or Plugin"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"We developed the features for the plan based on the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/orgs/answerdev/projects/1"},"roadmap"),". If you are suggestions for new functions, please confirm whether they have been planned."),(0,o.kt)("li",{parentName:"ol"},"Plugins will be available in the future, so stay tuned.")),(0,o.kt)("h2",{id:"notice"},"Notice"),(0,o.kt)("h3",{id:"modify-the-database-table-structure-is-very-hard"},"Modify the database table structure is very hard"),(0,o.kt)("p",null,"Usually, we don't want to modify the field that already exists in the database table.\nIf you need to change it, follow these rules."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Adding fields is better than modifying them."),(0,o.kt)("li",{parentName:"ol"},"Modifying any field needs to take into account the impact on the existing data."),(0,o.kt)("li",{parentName:"ol"},"Changes to database tables need to be tested for impact on different types of databases, and different SQL statements need to be given for different types of databases. For MySQL/PostgreSQL/sqlite3.")),(0,o.kt)("h2",{id:"built-with"},"Built with"),(0,o.kt)("p",null,"The Answer application's backend is built with the following components/libraries:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/segmentfault/pacman"},"pacman")," - Yet Another Toolkit to Build Golang Application Quickly."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/gin-gonic/gin/"},"gin")," - Router."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/go-playground/validator/"},"validator")," - Validator."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://xorm.io/"},"xorm")," - ORM."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/spf13/cobra"},"cobra")," - CLI applications."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/swaggo/swag"},"swag")," -  Swagger Documentation generate.")))}c.isMDXComponent=!0},3615:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/repo-unit-test-coverage-rate-380ed64eb67caf2d5132e22e435310db.png"}}]);